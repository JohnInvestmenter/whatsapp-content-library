<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>InvestMenter – WhatsApp Content Library</title>
  <link rel="icon" href="https://onecdn.io/media/ffb500c6-8305-4802-8cf9-6b55e6bd5ed5/md2x" />
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#F4C753',
            'background-light': '#f8f7f6',
            'background-dark': '#221d10',
            'content-light': '#111811',
            'content-dark': '#e8f0e8',
            'subtle-light': '#608a60',
            'subtle-dark': '#a0c2a0',
            'border-light': '#dbe6db',
            'border-dark': '#304a30'
          },
          fontFamily: { display: 'Lexend' }
        }
      }
    };
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-content-light dark:text-content-dark">
<div class="flex flex-col min-h-screen">

  <!-- Main -->
  <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Library -->
      <div class="lg:col-span-2 space-y-8">
        <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4">
          <div>
            <h2 class="text-2xl font-semibold tracking-tight">Content Library</h2>
            <p class="text-subtle-light dark:text-subtle-dark mt-1">Manage your content for WhatsApp</p>
          </div>
        </div>

        <!-- Cards Grid -->
        <div id="contentGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 items-stretch"></div>
        <!-- Pagination -->
        <div id="pagination" class="flex justify-center gap-2 mt-6"></div>
      </div>

      <!-- Add/Edit Form -->
      <div class="lg:col-span-1 space-y-8">
        <div class="p-6 border border-border-light dark:border-border-dark rounded-lg space-y-6">
          <h3 class="text-xl font-bold">Add / Edit Content</h3>
          <form id="addForm" class="space-y-4">
            <input type="hidden" id="editId"/>
            <div>
              <label class="text-sm font-medium">Title</label>
              <input id="title" class="w-full px-3 py-2 border rounded-lg"/>
            </div>
            <div>
              <label class="text-sm font-medium">Category</label>
              <select id="category" class="form-select w-full px-3 py-2 border rounded-lg"></select>
            </div>
            <div>
              <label class="text-sm font-medium">Content</label>
              <textarea id="content" class="w-full px-3 py-2 border rounded-lg" rows="6"></textarea>
            </div>
            <div>
              <label class="text-sm font-medium">Tags</label>
              <input id="tags" class="w-full px-3 py-2 border rounded-lg"/>
            </div>
            <div>
              <label class="text-sm font-medium">Attachments</label>
              <input id="file-upload" type="file" multiple class="block w-full mt-2"/>
              <div id="attachmentsList" class="mt-2 flex flex-wrap gap-2"></div>
            </div>
            <div class="flex justify-between">
              <button id="saveBtn" class="px-4 py-2 rounded-lg bg-primary text-white font-bold">Save</button>
              <button id="cancelBtn" type="button" class="px-4 py-2 rounded-lg border">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
const API = 'https://whatsapp-content-library.vercel.app/api/contents';
let contents=[],newAttachments=[],currentPage=1,perPage=6;

// ====== UTILS ======
const $=(s)=>document.querySelector(s);
const escapeHtml=(s='')=>s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

// ====== FETCH ======
async function fetchJSON(url){const r=await fetch(url);return await r.json();}
async function syncContents(){const data=await fetchJSON(API);contents=Array.isArray(data)?data:[];render();}

// ====== RENDER ======
function render(){
  const grid=$("#contentGrid");const filtered=contents;
  const totalPages=Math.ceil(filtered.length/perPage);
  const start=(currentPage-1)*perPage;
  const paginated=filtered.slice(start,start+perPage);
  grid.innerHTML=paginated.map(c=>`
    <div class="border p-4 rounded-lg flex flex-col">
      <h3 class="font-semibold">${escapeHtml(c.title||'')}</h3>
      <p class="text-xs">${escapeHtml(c.category||'')}</p>
      <div class="flex gap-2 mt-2">
        <button class="editBtn px-2 border rounded text-xs" data-id="${c.id}">Edit</button>
      </div>
      <div class="mt-2 text-sm">${escapeHtml(c.content||'')}</div>
    </div>`).join('');
  $("#pagination").innerHTML=Array.from({length:totalPages},(_,i)=>`<button onclick="goToPage(${i+1})" class="px-2 ${i+1===currentPage?'bg-primary text-white':''}">${i+1}</button>`).join('');
  grid.querySelectorAll(".editBtn").forEach(btn=>btn.addEventListener("click",()=>loadForEdit(btn.dataset.id)));
}
function goToPage(n){currentPage=n;render();}

// ====== FORM ======
function clearForm(){ $("#addForm").reset();$("#editId").value="";newAttachments=[];drawAttachmentsUI();}
function drawAttachmentsUI(){
  $("#attachmentsList").innerHTML=newAttachments.map((a,i)=>`
    <div class="flex items-center gap-2 border px-2 py-1 rounded">
      <span>${escapeHtml(a.name)}</span>
      <button type="button" class="renameAtt text-blue-500" data-idx="${i}">✎</button>
      <button type="button" class="removeAtt text-red-500" data-idx="${i}">✕</button>
    </div>`).join('')||"No files yet.";
  $("#attachmentsList").querySelectorAll(".removeAtt").forEach(b=>b.onclick=()=>{newAttachments.splice(b.dataset.idx,1);drawAttachmentsUI();});
  $("#attachmentsList").querySelectorAll(".renameAtt").forEach(b=>b.onclick=()=>{const n=prompt("Rename:",newAttachments[b.dataset.idx].name);if(n){newAttachments[b.dataset.idx].name=n;drawAttachmentsUI();}});
}

// ====== CRUD ======
async function createItem(){
  const body={title:$("#title").value,content:$("#content").value,category:$("#category").value,tags:$("#tags").value.split(',').map(t=>t.trim()),attachments:newAttachments};
  await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
  clearForm();syncContents();
}
async function updateItem(id){
  const body={title:$("#title").value,content:$("#content").value,category:$("#category").value,tags:$("#tags").value.split(',').map(t=>t.trim()),attachments:newAttachments};
  await fetch(`${API}/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
  clearForm();syncContents();
}
function loadForEdit(id){
  const item=contents.find(c=>String(c.id)===String(id));if(!item)return;
  $("#editId").value=id;$("#title").value=item.title;$("#category").value=item.category;$("#content").value=item.content;$("#tags").value=(item.tags||[]).join(",");newAttachments=[...(item.attachments||[])];drawAttachmentsUI();
}

// ====== EVENTS ======
$("#addForm").addEventListener("submit",e=>{e.preventDefault();const id=$("#editId").value;if(id)updateItem(id);else createItem();});
$("#cancelBtn").addEventListener("click",clearForm);

// ====== INIT ======
window.addEventListener("DOMContentLoaded",()=>{syncContents();});
</script>
</body>
</html>
