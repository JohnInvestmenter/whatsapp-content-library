<script>
  async function createItem(){
    const title = (titleInput.value||'').trim();
    const category = categoryInput.value || 'General';
    const content = (contentInput.value||'').trim();
    const tags = (tagsInput.value||'').split(',').map(t=>t.trim()).filter(Boolean);

    if(!title || !content){
      alert('Please fill in both title and content.');
      return;
    }

    const body = {
      title,
      content,
      formattedContent: formatForWhatsApp(content),
      category,
      tags,
      dateCreated: new Date().toISOString().slice(0,10),
      useCount: 0
    };

    try {
      const r = await fetch('https://whatsapp-content-library.vercel.app/api/contents', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      if (!r.ok) {
        let msg = 'HTTP ' + r.status;
        try {
          const j = await r.json();
          if (j && (j.message || j.error)) msg = j.message || j.error;
        } catch (_) {
          const t = await r.text();
          if (t) msg = t;
        }
        throw new Error(msg);
      }

      // success
      closeModalFn();
      titleInput.value=''; contentInput.value=''; tagsInput.value='';
      await syncContents();
      alert('Content added!');
    } catch (err) {
      console.error(err);
      alert('Failed to add content: ' + err.message);
    }
  }
</script>
