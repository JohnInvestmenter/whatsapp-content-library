<!-- Keep your entire <head> as is -->

<body class="bg-background-light dark:bg-background-dark font-display text-content-light dark:text-content-dark">
<div class="flex flex-col min-h-screen">
  <!-- Header, Main content, add form, preview modal as you provided - KEEP ALL -->

  <!-- Your entire HTML structure here, unchanged -->

</div>

<script>
  // ===== CONFIG =====
  // Keep API endpoints as they are. Assumes your backend API handles DB
  const DEFAULT_API = 'https://whatsapp-content-library.vercel.app/api/contents';
  const urlParams = new URLSearchParams(location.search);
  const API = urlParams.get('api') || DEFAULT_API;

  // Your existing categories remain the same
  const categories = ['Motivation','Tech Tips','Fun Facts','Announcements','Events','Educational'];

  // ===== STATE =====
  let contents = [];
  let newAttachments = []; // hold uploaded file info

  // ===== THEME, UTILS & HELPER FUNCTIONS =====
  // All existing helper functions remain unchanged (escapeHtml, toWhatsApp, whatsappPreviewHTML, etc.)

  // ===== API INTEGRATION =====
  async function fetchJSON(url) {
    const res = await fetch(url, { headers: { 'Accept': 'application/json' }, mode: 'cors' });
    if (!res.ok) {
      const errorData = await res.json().catch(() => ({}));
      const message = errorData?.error || errorData?.message || 'Unknown error';
      throw new Error(`HTTP ${res.status}: ${message}`);
    }
    return await res.json();
  }

  async function syncContents() {
    clearToast();
    $('#syncBtn')?.classList.add('opacity-70', 'pointer-events-none');
    try {
      const data = await fetchJSON(API);
      contents = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : (Array.isArray(data.data) ? data.data : []));
      renderCategories();
      render();
      if (!contents.length) toast('ok', 'No content returned from API. Use ?api=YOUR_ENDPOINT to override.');
    } catch (e) {
      toast('error', 'Sync failed: ' + e.message);
      console.error('[sync] failed:', e);
    } finally {
      $('#syncBtn')?.classList.remove('opacity-70', 'pointer-events-none');
    }
  }

  // Post new content to backend API (expected to store in DB)
  async function createItem() {
    if (isUploading) return;

    const body = {
      title: title.value.trim(),
      content: content.value.trim(),
      formattedContent: toWhatsApp(content.value.trim()),
      category: category.value || 'General',
      tags: tags.value.split(',').map(t => t.trim()).filter(Boolean),
      dateCreated: new Date().toISOString().slice(0, 10),
      useCount: 0,
      attachments: newAttachments.map(a => ({ name: a.name, url: a.url }))
    };

    if (!body.title || !body.content) {
      updateSaveEnabled();
      return;
    }

    try {
      setUploading(true);
      const res = await fetch(API, {
        method: 'POST',
        body: JSON.stringify(body),
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        }
      });

      if (!res.ok) {
        const errorData = await res.json().catch(() => ({}));
        throw new Error(errorData.message || errorData.error || `HTTP ${res.status}`);
      }

      clearForm();
      await syncContents();
      toast('ok', 'Content added successfully.');
    } catch (err) {
      toast('error', 'Failed to add content: ' + err.message);
      console.error('Create item error:', err);
    } finally {
      setUploading(false);
      updateSaveEnabled();
    }
  }

  // ===== FILE UPLOAD & ATTACHMENTS =====
  // Keep your existing implementation for file uploads and drag-drop intact for Drive Upload or your integration.

  // ===== RENDER FUNCTIONS =====
  // Keep your existing render(), renderCategories() unchanged.

  // ===== COPY TO CLIPBOARD, PREVIEW, FORM HANDLERS, THEME =====
  // Keep your functions for copyToClipboard, openPreview, form input listeners unchanged.

  // ===== BOOT =====
  window.addEventListener('DOMContentLoaded', () => {
    renderCategories();
    syncContents();
    updateSaveEnabled();
  });
</script>
</body>
</html>
