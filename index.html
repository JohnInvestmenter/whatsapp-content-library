<!DOCTYPE html> <html class="dark" lang="en"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <title>InvestMenter – WhatsApp Content Library</title> <link rel="icon" href="https://onecdn.io/media/ffb500c6-8305-4802-8cf9-6b55e6bd5ed5/md2x" /> <link href="https://fonts.googleapis.com" rel="preconnect"/> <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin/> <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700;900&display=swap" rel="stylesheet"/> <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/> <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script> <script> tailwind.config = { darkMode: 'class', theme: { extend: { colors: { primary: '#F4C753', 'background-light': '#f8f7f6', 'background-dark': '#221d10', 'content-light': '#111811', 'content-dark': '#e8f0e8', 'subtle-light': '#608a60', 'subtle-dark': '#a0c2a0', 'border-light': '#dbe6db', 'border-dark': '#304a30' }, fontFamily: { display: 'Lexend' }, borderRadius: { DEFAULT: '0.25rem', lg: '0.5rem', xl: '0.75rem', full: '9999px' } } } }; </script> <style> .form-select{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23608a60' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem;-webkit-print-color-adjust:exact;print-color-adjust:exact} .dark .form-select{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23a0c2a0' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")} .scrollbar-thin{scrollbar-width:thin} .scrollbar-thin::-webkit-scrollbar{height:6px;width:6px} .scrollbar-thin::-webkit-scrollbar-thumb{background:rgba(0,0,0,.25);border-radius:9999px} </style> </head> <body class="bg-background-light dark:bg-background-dark font-display text-content-light dark:text-content-dark"> <div class="flex flex-col min-h-screen"> <!-- Header --> <header class="sticky top-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm z-10 border-b border-border-light dark:border-border-dark"> <div class="container mx-auto px-4 sm:px-6 lg:px-8"> <div class="flex items-center justify-between h-16"> <div class="flex items-center gap-3"> <img src="https://onecdn.io/media/ffb500c6-8305-4802-8cf9-6b55e6bd5ed5/md2x" alt="InvestMenter" class="h-8 w-auto object-contain" referrerpolicy="no-referrer" onerror="this.onerror=null;this.src='https://api.dicebear.com/7.x/initials/svg?seed=IM';" /> <h1 class="text-xl font-bold">InvestMenter WhatsApp Content Library</h1> </div> <nav class="hidden md:flex items-center gap-8"> <a class="text-sm font-medium text-primary" href="#">Content Library</a> </nav> <div class="flex items-center gap-4"> <button id="themeToggle" class="p-2 rounded-full hover:bg-primary/10" title="Toggle theme"> <span class="material-symbols-outlined">dark_mode</span> </button> </div> </div> </div> </header> <!-- Main --> <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8"> <div class="grid grid-cols-1 lg:grid-cols-3 gap-8"> <!-- Library --> <div class="lg:col-span-2 space-y-8"> <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4"> <div> <h2 class="text-2xl font-semibold tracking-tight">Content Library</h2> <p class="text-subtle-light dark:text-subtle-dark mt-1">Manage your content for WhatsApp</p> </div> <div class="flex items-center gap-3"> <button id="syncBtn" class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-primary/20 hover:bg-primary/30 dark:bg-primary/30 dark:hover:bg-primary/40 transition-colors text-sm font-bold"> <span class="material-symbols-outlined text-base">sync</span> Sync Now </button> <button id="scrollToForm" class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-primary text-white hover:opacity-90 transition-opacity text-sm font-bold"> <span class="material-symbols-outlined text-base">add</span> Add Content </button> </div> </div> <!-- Filters --> <div class="grid grid-cols-1 md:grid-cols-3 gap-3"> <input id="searchInput" placeholder="Search…" class="px-3 py-2 rounded-lg bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark"/> <select id="categorySelect" class="form-select px-3 py-2 rounded-lg bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark"><option value="all">All Categories</option></select> <div class="flex items-stretch"> <button id="clearFilters" class="px-3 py-2 rounded-l-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark hover:bg-primary/10 dark:hover:bg-primary/20 text-sm font-bold">Clear</button> <button id="copySelected" class="px-3 py-2 rounded-r-lg border-y border-r border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark hover:bg-primary/10 dark:hover:bg-primary/20 text-sm font-bold" title="Copy highlighted (first) item">Quick Copy</button> </div> </div> <!-- Cards Grid --> <div id="contentGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 items-stretch"></div> <div id="messageBar" class="hidden mt-4"></div> </div> <!-- Add New Content + Live Preview --> <div class="lg:col-span-1 space-y-8"> <div class="bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark p-6 rounded-lg space-y-6"> <h3 class="text-xl font-bold">Add New Content</h3> <form id="addForm" class="space-y-4"> <div> <label for="title" class="text-sm font-medium">Title</label> <input id="title" class="mt-1 block w-full px-3 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg focus:outline-none focus:ring-primary focus:border-primary sm:text-sm placeholder-subtle-light dark:placeholder-subtle-dark" placeholder="Enter title" type="text"/> </div> <div> <label for="category" class="text-sm font-medium">Category</label> <select id="category" class="form-select mt-1 block w-full pl-3 pr-10 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg focus:outline-none focus:ring-primary focus:border-primary sm:text-sm appearance-none"></select> </div> <div> <label for="content" class="text-sm font-medium">Content</label> <textarea id="content" class="mt-2 block w-full px-3 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg focus:outline-none focus:ring-primary focus:border-primary sm:text-sm placeholder-subtle-light dark:placeholder-subtle-dark" placeholder="Use **bold**, __italic__, ~~strike~~ and code." rows="6"></textarea> </div> <div> <label for="tags" class="text-sm font-medium">Tags</label> <input id="tags" class="mt-1 block w-full px-3 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg focus:outline-none focus:ring-primary focus:border-primary sm:text-sm placeholder-subtle-light dark:placeholder-subtle-dark" placeholder="Enter tags, separated by commas" type="text"/> </div> <div> <label class="text-sm font-medium">Attachments</label> <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-border-light dark:border-border-dark border-dashed rounded-lg"> <div class="space-y-1 text-center w-full"> <span class="material-symbols-outlined text-4xl text-subtle-light dark:text-subtle-dark">cloud_upload</span> <div class="flex text-sm text-subtle-light dark:text-subtle-dark justify-center"> <label for="file-upload" class="relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary"> <span>Upload files</span> <input id="file-upload" type="file" class="sr-only" multiple/> </label> <p class="pl-1">or drag and drop</p> </div> <p class="text-xs text-subtle-light dark:text-subtle-dark">Images, Videos, PDFs, Docs</p> <div id="attachmentsList" class="mt-2 flex flex-wrap gap-2"></div> </div> </div> </div> <div class="pt-4 flex flex-col sm:flex-row-reverse gap-3"> <button id="saveBtn" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-bold text-white bg-primary hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-background-dark disabled:opacity-50" type="submit" disabled> <span id="saveText">Save</span> <svg id="saveSpinner" class="hidden animate-spin h-4 w-4" viewBox="0 0 24 24" fill="none"> <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a 8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"></path> </svg> </button> <button id="cancelBtn" class="w-full sm:w-auto inline-flex justify-center py-2 px-4 border border-border-light dark:border-border-dark rounded-lg shadow-sm text-sm font-bold bg-background-light dark:bg-background-dark hover:bg-primary/10 dark:hover:bg-primary/20" type="button">Cancel</button> <button id="clearBtn" class="w-full sm:w-auto mr-auto inline-flex justify-center py-2 px-4 text-sm font-bold text-subtle-light dark:text-subtle-dark hover:text-content-light dark:hover:text-content-dark" type="reset">Clear</button> </div> </form> </div> <div class="bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark p-6 rounded-lg space-y-4"> <h3 class="text-xl font-bold">WhatsApp Preview</h3> <p class="text-sm text-subtle-light dark:text-subtle-dark">Live preview of how your content will appear.</p> <div class="bg-gray-200 dark:bg-gray-800 p-4 rounded-lg"> <div class="flex items-start gap-2.5"> <span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"> <img alt="User Avatar" class="aspect-square h-full w-full" referrerpolicy="no-referrer" src="https://lh3.googleusercontent.com/a/ACg8ocK_3tA3yV-5c-Q1J5YgX_o_E_4z-e-yH2gY_e-Z6U=s96-c" onerror="this.onerror=null;this.src='https://api.dicebear.com/7.x/initials/svg?seed=IM';" /> </span> <div class="grid gap-1 w-full"> <div id="previewTitle" class="font-semibold text-gray-900 dark:text-gray-50">—</div> <div id="waPreview" class="text-sm leading-snug text-gray-700 dark:text-gray-300 whitespace-pre-wrap max-h-48 overflow-auto scrollbar-thin">(start typing…)</div> </div> </div> </div> </div> </div> <!-- /right column --> </div> </main> <!-- Preview Modal --> <div id="previewModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50 p-4"> <div class="w-full max-w-2xl bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg shadow-xl"> <div class="flex items-center justify-between p-4 border-b border-border-light dark:border-border-dark"> <h3 class="text-lg font-bold">WhatsApp Preview</h3> <button id="previewClose" class="p-2 rounded-lg hover:bg-primary/10"><span class="material-symbols-outlined">close</span></button> </div> <div class="p-6"> <p class="text-sm text-subtle-light dark:text-subtle-dark mb-3">Live preview of how this content will appear.</p> <div class="bg-gray-200 dark:bg-gray-800 p-4 rounded-lg"> <div class="flex items-start gap-2.5"> <span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"> <img id="modalAvatar" class="aspect-square h-full w-full" alt="Avatar" referrerpolicy="no-referrer" src="https://lh3.googleusercontent.com/a/ACg8ocK_3tA3yV-5c-Q1J5YgX_o_E_4z-e-yH2gY_e-Z6U=s96-c" onerror="this.onerror=null;this.src='https://api.dicebear.com/7.x/initials/svg?seed=IM';" /> </span> <div class="grid gap-1 w-full"> <div id="modalTitle" class="font-semibold text-gray-900 dark:text-gray-50">—</div> <div id="modalBody" class="text-sm leading-snug text-gray-700 dark:text-gray-300 whitespace-pre-wrap max-h-72 overflow-auto scrollbar-thin">(content)</div> </div> </div> </div> <div id="modalAttachments" class="mt-4 flex flex-wrap gap-2"></div> </div> <div class="p-4 border-t border-border-light dark:border-border-dark flex justify-end gap-2"> <button id="modalCopy" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-border-light dark:border-border-dark hover:bg-primary/10 dark:hover:bg-primary/20 text-sm font-bold"><span class="material-symbols-outlined text-base">content_copy</span> Copy</button> <button id="previewDismiss" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white hover:opacity-90 text-sm font-bold">Close</button> </div> </div> </div> </div> <script> // ===== CONFIG ===== const DEFAULT_API = 'https://whatsapp-content-library.vercel.app/api/contents'; const urlParams = new URLSearchParams(location.search); const API = urlParams.get('api') || DEFAULT_API; const DRIVE_UPLOAD_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwWgZ3B3vcN4flFQo1-Ul-AVjVGZozfoe8RDcbr8ez2d_d7r9XvQ7tnePY5q8ZC4w7Ziw/exec'; const categories = ['Motivation','Tech Tips','Fun Facts','Announcements','Events','Educational']; // ===== STATE ===== let contents = []; let newAttachments = []; // {name, url, mimeType} let isUploading = false; // ===== THEME ===== const themeToggle = document.getElementById('themeToggle'); function applyTheme(mode){ document.documentElement.classList.toggle('dark', mode==='dark'); localStorage.setItem('theme', mode); } themeToggle?.addEventListener('click', ()=>{ const mode = document.documentElement.classList.contains('dark')?'light':'dark'; applyTheme(mode); }); applyTheme(localStorage.getItem('theme')||'dark'); // ===== UTILS ===== const $ = (sel)=>document.querySelector(sel); const messageBar = $('#messageBar'); const escapeHtml = (s='') => s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); // WhatsApp marker conversions const toWhatsApp = (text='') => text .replace(/\*\*(.*?)\*\*/g,'*$1*') .replace(/__(.*?)__/g,'_$1_') .replace(/~~(.*?)~~/g,'~$1~') .replace(/(.*?)/g,'$1'); function whatsappPreviewHTML(text=''){ const safe = escapeHtml(text); return safe .replace(/\*(.*?)\*/g,'<strong>$1</strong>') .replace(/_(.*?)_/g,'<em>$1</em>') .replace(/~(.*?)~/g,'<s>$1</s>') .replace(/([^]+)/g,'<code>$1</code>'); } function fileToBase64(file){ return new Promise((resolve, reject)=>{ const fr = new FileReader(); fr.onload = ()=>{ const base64 = String(fr.result).split(',')[1]||''; resolve({ name:file.name, mimeType:file.type||'application/octet-stream', dataBase64: base64 }); }; fr.onerror = reject; fr.readAsDataURL(file); }); } async function uploadFilesToDrive(files){ const encoded = await Promise.all(files.map(fileToBase64)); const res = await fetch(DRIVE_UPLOAD_ENDPOINT, { method:'POST', body: JSON.stringify({ files: encoded }) }); const data = await res.json().catch(()=>({success:false,error:'Invalid JSON from server'})); if(!res.ok || !data.success) throw new Error(data.error || ('HTTP '+res.status)); return (data.files||[]).map(f=>({ name:f.name, url:f.webViewLink||f.url, mimeType:f.mimeType })); } function toast(type, text){ messageBar.className = ''; const base = 'mt-4 p-3 rounded-lg border text-sm'; const styles = type==='error' ? 'border-red-400 text-red-200 bg-red-900/20' : 'border-emerald-400 text-emerald-200 bg-emerald-900/20'; messageBar.className = base + ' ' + styles; messageBar.textContent = text; messageBar.classList.remove('hidden'); } function clearToast(){ messageBar.classList.add('hidden'); messageBar.textContent=''; } // ===== API ===== async function fetchJSON(url){ const res = await fetch(url, { headers:{'Accept':'application/json'}, mode: 'cors' }); let data = null; try { data = await res.json(); } catch(e){ throw new Error('Invalid JSON from '+url); } if(!res.ok) throw new Error((data && (data.error||data.message)) || ('HTTP '+res.status)); return data; } async function syncContents(){ clearToast(); $('#syncBtn')?.classList.add('opacity-70','pointer-events-none'); try{ const data = await fetchJSON(API); const items = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : (Array.isArray(data.data) ? data.data : [])); contents = items; renderCategories(); render(); if(!items.length){ toast('ok', 'No content returned from API. You can pass ?api=YOUR_ENDPOINT to override.'); } }catch(e){ console.error('[sync] failed', e); toast('error', 'Sync failed: '+ e.message + ' — open the console for details.'); }finally{ $('#syncBtn')?.classList.remove('opacity-70','pointer-events-none'); } } async function createItem(){ if(isUploading) return; const body = { title: (title.value||'').trim(), content: (content.value||'').trim(), formattedContent: toWhatsApp((content.value||'').trim()), category: category.value || 'General', tags: (tags.value||'').split(',').map(t=>t.trim()).filter(Boolean), dateCreated: new Date().toISOString().slice(0,10), useCount: 0, attachments: newAttachments.map(a=>({ name:a.name, url:a.url })) }; if(!body.title || !body.content){ updateSaveEnabled(); return; } try{ saveBtn.disabled = true; const r = await fetch(API, { method:'POST', headers:{'Content-Type':'application/json','Accept':'application/json'}, body: JSON.stringify(body) }); const j = await r.json().catch(()=>({})); if(!r.ok || j.error){ throw new Error(j.message || j.error || ('HTTP '+r.status)); } clearForm(); await syncContents(); toast('ok','Content added'); }catch(err){ console.error(err); toast('error','Failed to add content: '+err.message); } finally{ updateSaveEnabled(); } } // ===== RENDER ===== function render(){ const grid = document.getElementById('contentGrid'); const search = (searchInput.value||'').toLowerCase(); const cat = categorySelect.value; const filtered = contents.filter(c => (!search || (c.title||'').toLowerCase().includes(search) || (c.content||'').toLowerCase().includes(search) || (c.tags||[]).some(t=> (t||'').toLowerCase().includes(search))) && (cat==='all' || c.category===cat) ); if(!filtered.length){ grid.innerHTML = <div class="col-span-full border border-dashed border-border-light dark:border-border-dark rounded-lg p-8 text-center text-subtle-light dark:text-subtle-dark">No content found. Try syncing or clearing filters.</div>; return; } grid.innerHTML = filtered.map(c=>{ const waText = c.formattedContent || toWhatsApp(c.content||''); const waHTML = whatsappPreviewHTML(waText); const used = Number(c.useCount||0); let img = null; if (Array.isArray(c.attachments)) { img = c.attachments.find(a => /\.(png|jpe?g|gif|webp|bmp|svg)$/i.test((a.name||'') + (a.url||''))); } return <div class="h-full"> <!-- Fixed uniform height; preview flexes --> <div class="border border-border-light dark:border-border-dark rounded-lg p-4 flex flex-col h-[420px] bg-background-light dark:bg-background-dark"> <div class="flex items-start justify-between gap-3"> <div class="flex-1"> <h3 class="font-semibold text-sm leading-tight line-clamp-3">${escapeHtml(c.title||'')}</h3> <div class="mt-1 flex items-center gap-2 text-xs text-subtle-light dark:text-subtle-dark"> <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-primary/20 font-bold">${escapeHtml(c.category||'')}</span> <span>Used ${used} times</span> </div> </div> <div class="flex gap-1 shrink-0"> <button class="previewBtn p-2 rounded-lg border border-border-light dark:border-border-dark hover:bg-primary/10 dark:hover:bg-primary/20" title="Preview" data-id="${escapeHtml(String(c.id||''))}"> <span class="material-symbols-outlined text-base leading-none">visibility</span> </button> <button class="copyBtn p-2 rounded-lg border border-border-light dark:border-border-dark hover:bg-primary/10 dark:hover:bg-primary/20" title="Copy" data-id="${escapeHtml(String(c.id||''))}"> <span class="material-symbols-outlined text-base leading-none">content_copy</span> </button> </div> </div> ${(c.attachments&&c.attachments.length)? <div class="flex flex-wrap gap-2 mt-2"> ${c.attachments.map(a=><a href="${escapeHtml(a.url)}" target="_blank" class="text-xs underline px-2 py-1 rounded border border-border-light dark:border-border-dark">${escapeHtml(a.name || (a.url||'').split('/').pop())}</a>).join('')} </div> :''} <div class="mt-3 flex-1 min-h-0 rounded-lg border border-border-light dark:border-border-dark overflow-hidden"> <div class="h-full overflow-auto p-3 text-sm scrollbar-thin bg-background-light dark:bg-background-dark"> ${img ? <img src="${escapeHtml(img.url)}" alt="attachment" class="w-full rounded mb-3" referrerpolicy="no-referrer" loading="lazy" onerror="this.style.display='none';" /> : '' } <div class="whitespace-pre-wrap">${waHTML}</div> </div> </div> <div class="flex flex-wrap gap-1 mt-3"> ${(c.tags||[]).map(t=><span class="px-2 py-0.5 rounded bg-black/5 dark:bg-white/10 text-xs">${escapeHtml('#'+t)}</span>).join('')} </div> <div class="text-xs text-subtle-light dark:text-subtle-dark flex justify-between mt-auto pt-3"> <span>Created: ${escapeHtml(c.dateCreated||'')}</span> ${c.lastUsed?<span>Last used: ${escapeHtml(c.lastUsed)}</span>:'<span></span>'} </div> </div> </div>; }).join(''); grid.querySelectorAll('.copyBtn').forEach(btn=>{ btn.addEventListener('click', ()=> copyToClipboard(btn.getAttribute('data-id'))); }); grid.querySelectorAll('.previewBtn').forEach(btn=>{ btn.addEventListener('click', ()=>{ const id = btn.getAttribute('data-id'); const item = contents.find(x=>String(x.id)===String(id)); if(item) openPreview(item); }); }); } async function copyToClipboard(id){ try{ const item = contents.find(x=>String(x.id)===String(id)); if(!item) return alert('Item not found.'); await navigator.clipboard.writeText(item.formattedContent || item.content || ''); item.useCount = Number(item.useCount||0) + 1; item.lastUsed = new Date().toISOString().slice(0,10); render(); toast('ok','Copied to clipboard'); }catch(e){ console.error(e); toast('error','Copy failed'); } } // ===== FORM / UI ===== const addForm = document.getElementById('addForm'); const title = document.getElementById('title'); const category = document.getElementById('category'); const content = document.getElementById('content'); const tags = document.getElementById('tags'); const fileUpload = document.getElementById('file-upload'); const attachmentsList = document.getElementById('attachmentsList'); const saveBtn = document.getElementById('saveBtn'); const cancelBtn = document.getElementById('cancelBtn'); const clearBtn = document.getElementById('clearBtn'); const previewTitle = document.getElementById('previewTitle'); const waPreview = document.getElementById('waPreview'); function setUploading(on){ isUploading = on; saveBtn.disabled = on || !canSaveNow(); document.getElementById('saveText').textContent = on ? 'Uploading…' : 'Save'; document.getElementById('saveSpinner').classList.toggle('hidden', !on); } function canSaveNow(){ const hasTitle = (title.value||'').trim().length>0; const hasContent = (content.value||'').trim().length>0; return hasTitle && hasContent && !isUploading; } function updateSaveEnabled(){ saveBtn.disabled = !canSaveNow(); } function clearForm(){ addForm.reset(); newAttachments = []; drawAttachmentsUI(); previewTitle.textContent = '—'; waPreview.innerHTML = '(start typing…)'; updateSaveEnabled(); } function drawAttachmentsUI(){ attachmentsList.innerHTML = newAttachments.map((a,idx)=> <div class="inline-flex items-center gap-2 border border-border-light dark:border-border-dark rounded px-2 py-1"> <span class="material-symbols-outlined text-base">description</span> <a href="${escapeHtml(a.url)}" target="_blank" class="text-sm underline">${escapeHtml(a.name || (a.url||'').split('/').pop())}</a> <button type="button" class="removeAtt px-1 text-subtle-light dark:text-subtle-dark hover:text-red-500" data-idx="${idx}" ${isUploading?'disabled':''}> <span class="material-symbols-outlined text-base leading-none">close</span> </button> </div> ).join('') || '<div class="text-sm text-subtle-light dark:text-subtle-dark">No files yet.</div>'; attachmentsList.querySelectorAll('.removeAtt').forEach(b=>{ b.addEventListener('click', ()=>{ const i = Number(b.getAttribute('data-idx')); newAttachments.splice(i,1); drawAttachmentsUI(); }); }); } // Drag & drop ;['dragenter','dragover'].forEach(evt=>{ document.addEventListener(evt, e=>{ if(e.target.closest('#addForm')) { e.preventDefault(); } }, false); }); document.addEventListener('drop', async e=>{ if(!e.target.closest('#addForm')) return; e.preventDefault(); const files = Array.from(e.dataTransfer.files||[]); if(!files.length) return; try{ setUploading(true); const uploaded = await uploadFilesToDrive(files); newAttachments.push(...uploaded); drawAttachmentsUI(); toast('ok','Uploaded to Drive'); }catch(err){ console.error(err); toast('error','Drive upload failed: '+err.message); } finally{ setUploading(false); updateSaveEnabled(); } }); // File input fileUpload.addEventListener('change', async (e)=>{ const files = Array.from(e.target.files||[]); if(!files.length) return; try{ setUploading(true); const uploaded = await uploadFilesToDrive(files); newAttachments.push(...uploaded); drawAttachmentsUI(); toast('ok','Uploaded to Drive'); }catch(err){ console.error(err); toast('error','Drive upload failed: '+err.message); } finally{ fileUpload.value=''; setUploading(false); updateSaveEnabled(); } }); // Live preview + enable save title.addEventListener('input', ()=>{ previewTitle.textContent = title.value||'—'; updateSaveEnabled(); }); content.addEventListener('input', ()=>{ const waText = toWhatsApp(content.value||''); waPreview.innerHTML = whatsappPreviewHTML(waText) || '(start typing…)'; updateSaveEnabled(); }); // Filters const searchInput = document.getElementById('searchInput'); const categorySelect = document.getElementById('categorySelect'); document.getElementById('clearFilters').addEventListener('click', ()=>{ searchInput.value=''; categorySelect.value='all'; render(); }); document.getElementById('copySelected').addEventListener('click', ()=>{ const first = document.querySelector('#contentGrid .copyBtn'); if(first){ first.click(); } }); searchInput.addEventListener('input', render); categorySelect.addEventListener('change', render); // Actions document.getElementById('syncBtn').addEventListener('click', syncContents); document.getElementById('scrollToForm').addEventListener('click', ()=>{ document.getElementById('addForm').scrollIntoView({ behavior: 'smooth' }); title.focus(); }); document.getElementById('addForm').addEventListener('submit', (e)=>{ e.preventDefault(); createItem(); }); cancelBtn.addEventListener('click', clearForm); clearBtn.addEventListener('click', clearForm); // Category options function renderCategories(){ const formSel = document.getElementById('category'); formSel.innerHTML = '<option value="">Select category</option>' + categories.map(c=><option value="${c}">${c}</option>).join(''); const sel = document.getElementById('categorySelect'); const current = sel.value||'all'; sel.innerHTML = '<option value="all">All Categories</option>' + categories.map(c=><option value="${c}">${c}</option>).join(''); if(categories.includes(current)) sel.value = current; } // ===== Preview Modal ===== const previewModal = document.getElementById('previewModal'); const previewClose = document.getElementById('previewClose'); const previewDismiss = document.getElementById('previewDismiss'); const modalTitle = document.getElementById('modalTitle'); const modalBody = document.getElementById('modalBody'); const modalAttachments = document.getElementById('modalAttachments'); const modalCopy = document.getElementById('modalCopy'); let modalCurrentItem = null; function openPreview(item){ modalCurrentItem = item; modalTitle.textContent = item.title || '—'; const waText = item.formattedContent || (item.content || ''); modalBody.innerHTML = whatsappPreviewHTML(waText) || '(no content)'; modalAttachments.innerHTML = (item.attachments||[]) .map(a => <a href="${escapeHtml(a.url)}" target="_blank" class="text-xs underline px-2 py-1 rounded border border-border-light dark:border-border-dark">${escapeHtml(a.name || (a.url||'').split('/').pop())}</a>) .join(''); previewModal.classList.remove('hidden'); previewModal.classList.add('flex'); } function closePreview(){ previewModal.classList.add('hidden'); previewModal.classList.remove('flex'); modalCurrentItem=null; } previewClose.addEventListener('click', closePreview); previewDismiss.addEventListener('click', closePreview); previewModal.addEventListener('click', (e)=>{ if(e.target===previewModal) closePreview(); }); document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePreview(); }); modalCopy.addEventListener('click', async ()=>{ if(!modalCurrentItem) return; try{ await navigator.clipboard.writeText(modalCurrentItem.formattedContent || modalCurrentItem.content || ''); toast('ok','Copied to clipboard'); closePreview(); }catch(e){ toast('error','Copy failed'); } }); // Boot window.addEventListener('DOMContentLoaded', ()=>{ renderCategories(); syncContents(); updateSaveEnabled(); }); </script> </body> </html>
